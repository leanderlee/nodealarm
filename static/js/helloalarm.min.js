var version_string="0.4",analytics_switch=!0;try{var mpmetrics=new MixpanelLib("ca914755a14efe61584e8471cddcdd37")}catch(err){var null_fn=function(){},mpmetrics={track:null_fn,track_funnel:null_fn,register:null_fn,register_once:null_fn,register_funnel:null_fn,identify:null_fn}}
var User={pref:{},check:function(a,b){$.ajax({url:"json/check-email",data:{email:a},type:"POST",dataType:"json",success:function(a){b&&b.call(this,a)}})},login:function(a,b,c,d){$.ajax({url:"json/login",data:{email:a,password:b},type:"POST",dataType:"json",success:function(b){b.success?c&&c.call(this,a):d&&d.call(this,b.message||" our programmers are at the zoo")}})},logout:function(){$.ajax({url:"/logout",data:{},type:"GET",dataType:"json",success:function(){}})},save:function(a,b){User.pref[a]=
b;User.set_pref(User.pref)},set_pref:function(a){$.ajax({url:"/json/set-prefs",data:{prefs:JSON.stringify(a)},type:"POST",dataType:"json",success:function(){}})},get_pref:function(a){$.ajax({url:"/json/get-prefs",data:{},type:"GET",dataType:"json",success:function(b){a.call(this,b)}})},register:function(a,b,c,d){$.ajax({url:"json/register",data:{email:a,password:b},type:"POST",dataType:"json",success:function(f){f.success?User.login(a,b,c,function(){}):d&&d.call(this,f.message||" our programmers are sleeping")}})}},
Utilities={is_chrome:navigator.userAgent.match(/chrome/gi),is_playable:function(a){var b=document.createElement("audio");return!(!b.canPlayType||!b.canPlayType(a).replace(/no/,""))},query_string:function(a){return 0<=location.search.search(RegExp("[?&]"+a+"=([^&$]*)","i"))?RegExp.$1:null},cookie:function(a){return(a=document.cookie.match("\\b"+a+"=([^;]*)\\b"))?a[1]:void 0}};Utilities.mp3able=Utilities.is_playable("audio/mpeg;");Utilities.oggable=Utilities.is_playable('audio/ogg; codecs="vorbis"');
var Language={day_map:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday".split(","),mon_map:"January,February,March,April,May,June,July,August,September,October,November,December".split(","),max_day_map:[31,28,31,30,31,30,31,31,30,31,30,31],str_to_seconds:function(a){var a=a.replace(/(^\s*|\s+)an?\s+/gi," 1 "),a=a.replace(/(\d+)$/gi,"$1 m "),b={s:1E3,m:6E4,"hr?":36E5,d:864E5,w:6048E5,"sec.*?":1E3,"min.*?":6E4,"hour.*?":36E5,"day.*?":864E5,"week.*?":6048E5},c=0,d,f;for(d in b)if(b.hasOwnProperty(d)){var e=
a.match(RegExp("\\d+\\s*"+d+"(\\s+|\\s*$)","gi"));if(e)for(f=0;f<e.length;f++){var g=e[f].match(/^\d+/gi);g&&(g=parseFloat(g[0]),c+=g*b[d])}}return c},str_to_date:function(a){var b=a.match(/[^\s]+/g),c=new Date,d=!1,f=!1,e=!1,g=c.getDate(),h=c.getMonth(),k=c.getFullYear(),i=0,j=0,l,m;if(!a.match(/(tmr?|tomorrow)/)){var o="jan.*,feb.*?,mar.*?,apr.*?,may,jun.*?,jul.*?,aug.*?,sep.*?,oct.*?,nov.*?,dec.*?".split(","),p="(first|1\\s?st),(second|2\\s?nd),(third|3\\s?rd),fourth,fifth,sixth".split(",");for(l=
0;l<o.length;l++)for(a=0;a<b.length;a++)if(b[a].match(RegExp(o[l],"gi"))){f=!0;h=l;if("of"===b[a-1])if(b[a-2].match(/^\d+th$/gi))d=!0,g=parseInt(b[a-2].substr(0,b[a-2].length-2),10);else if(!b[a-2].match(/week/gi))for(m=0;m<p.length;m++)if(b[a-2].match(RegExp(p[m],"gi"))){d=!0;g=m+1;break}!d&&b[a+1]&&b[a+1].match(/\d+/)&&(d=!0,g=parseInt(b[a+1],10));d&&(h<c.getMonth()||h===c.getMonth()&&g<c.getDate())&&k++}}for(a=0;a<b.length;a++)if("at"===b[a]||"for"===b[a]){l=b[a+1];for(m=a+2;m<b.length;m++)l+=
" "+b[m];if(l.match(/\d{1,2}(:\d{2})?\s*((a|p)\.?m?\.?)?$/gi)){e=!0;m=l.match(/\d{1,2}(:\d{2})?/)[0].split(":");p=o=0;i=parseInt(m[0],10);1<m.length&&(j=parseInt(m[1],10));if(12<i)o=i/24,p=0,i%=24;else if(p=l.match(/pm?\.?$/gi)?12:l.match(/am?\.?$/gi)?0:c.getHours()>i?12:0,!d&&(i+p<c.getHours()||i+p===c.getHours()&&j<c.getMinutes()))o=1;i+=p;g+=o}}c.setMinutes(j);c.setHours(i);c.setDate(g);c.setMonth(h);c.setFullYear(k);return!d&&!f&&!e?!1:c},date_to_str:function(a){return Language.day_map[a.getDay()]+
", "+Language.mon_map[a.getMonth()]+" "+a.getDate()},date_to_time:function(a){var b=a.getHours()%12;return b+1+" "+a.getMinutes()+(11<=a.getHours()?" in the afternoon":" in the morning")}},Mediator=function(){var a=!1,b=$.Storage.get("login_email"),c=function(a){$.Storage.set("login_email",a);b=a};b&&(a=!0);User.get_pref(function(a){if(a)User.pref=a});return{is_logged_in:function(){return a},logout:function(){User.logout();c("","")},login:c}},Artist=function(a){var b,c=!1,d,f=[],e=!1,g={nothing:["No response from HelloAlarm."],
help:["Here are some hints to help you."],about:["HelloAlarm 2011 (v"+version_string+")"],greeting:["Hello! HelloAlarm at your service."],welcome:["You are very welcome.","It is my pleasure."],sorry:["Sorry, I didn't get that.","Sorry, I didn't catch that.","... um. I'm not sure what to say."],noone:["Nobody hears you."],okay:["Sure thing.","Yes, sir.","Consider it done.","Will do.","Okay."]},h=function(b,c){a.unbind("end");var d=a[0];d.src="/talk?text="+b;d.play();c&&a.bind("ended",function(){a.unbind("ended");
c.call(this)})},k=function(a,d){c=!1;resp=g[a]?g[a][Math.floor(Math.random()*g[a].length)]:a;$("#response").removeClass("error").removeClass("okay");$("#response").hide().text(resp).fadeIn("fast");"nothing"!==a&&h(resp,d);e=!0;b=setTimeout(i,1E4)},i=function(){e&&($("#response").fadeOut("fast"),e=!1)},j=function(){a.unbind("ended")};return{express:k,withdraw:i,switch_app:function(a){c=!1;a instanceof Screen&&a!=d&&(d&&(d.unbind(),d.quit(),j(),clearTimeout(b)),d=a,d.draw(),d.bind())},register:function(a){a instanceof
Application&&f.push(a)},receive:function(a){var b;for(b=0;b<f.length;b++)f[b].receive&&f[b].receive.call(f[b],a)},mute:function(){$("#command").hide()},unmute:function(){$("#command").fadeIn(200)},volume:function(b){if(void 0===b)return a[0].volume;a[0].volume=b},nocallback:j,hear:function(a){var b;c=!0;for(b=0;b<f.length;b++)f[b].hear&&f[b].hear.call(f[b],a);c&&k("nothing")},say:h}},Player=function(a){return{play:function(b,c,d){a.attr("loop",d);a[0].src=b;a[0].play();a.unbind("ended");c&&a.bind("ended",
c)},stop:function(){a[0].pause()},volume:function(b){if(void 0===b)return a[0].volume;a[0].volume=b},playlist:function(a,c){if(!a)return!1;var d=[],f;for(f=0;f<a.length;f++){var e=a[f],g=e.webkitRelativePath||e.mozFullPath||e.fileName,g=0<=g.indexOf("/")?g.substr(g.indexOf("/")):g,h=e.size||e.fileSize||4096;-1===g.indexOf(".AppleDouble")&&(4095>h||(-1!==e.fileName.indexOf("mp3")&&Utilities.mp3able||(-1!==e.fileName.indexOf("ogg")||-1!==e.fileName.indexOf("oga"))&&Utilities.oggable)&&d.push(e))}c&&
c(d);0<d.length&&mpmetrics.track("Found songs from hard drive.");return 0<d.length},file_url:function(a){var c;window.createObjectURL?c=window.createObjectURL(a):window.createBlobURL?c=window.createBlobURL(a):window.URL&&window.URL.createObjectURL?c=window.URL.createObjectURL(a):window.webkitURL&&window.webkitURL.createObjectURL&&(c=window.webkitURL.createObjectURL(a));return c},load_tags:function(a,c){if(localStorage[a.fileName])return c(JSON.parse(localStorage[a.fileName]));ID3v2.parseFile(a,function(d){localStorage[a.fileName]=
JSON.stringify({Title:d.Title,Artist:d.Artist,Album:d.Album,Genre:d.Genre});c(d)})}}},Clock=function(a){var b=function(){var c=new Date,d=c.getMinutes();a.find(".hours").text(c.getHours());a.find(".minutes").text(9<d?d:"0"+d);a.find(".colon").toggleClass("flash");setTimeout(b,1E3)};b();return a},Alarm=function(a,b){var c,d,f,e=3E5,g=[],h=!1,k=0,i,j=!1,l=!1,m=function(){if(g&&0<g.length){var b=Math.floor(Math.random()*g.length);console.log("Chose song "+b);a.play(g[b],function(){m()},!1)}else a.play("/beep.wav",
function(){m()},!0)},o=function(a,b,c,d,f,e){a.scale(1,0.5);a.moveTo(0,0);a.beginPath();a.lineWidth=d;a.strokeStyle=e;a.arc(149,149,f,1.5*Math.PI+2*b*Math.PI,2*c*Math.PI+1.5*Math.PI+2*b*Math.PI,!1);a.stroke()},p=function(){var a=new Date;$("#alarm .bar").each(function(){$(this)[0].width=$(this)[0].width});var b=[[20,80,"#4c4c4c",a.getHours()%12/12],[15,88,"#595959",a.getMinutes()/60]];b.sort(function(a,b){return a[3]-b[3]});o($("#alarm .bar.bar1")[0].getContext("2d"),0,b[0][3],b[0][0],b[0][1],b[0][2]);
o($("#alarm .bar.bar2")[0].getContext("2d"),b[0][3],b[1][3]-b[0][3],b[1][0],b[1][1],b[1][2]);if(f){$("#alarm .bar.bar3").show();var b=f.getHours(),c=f.getMinutes(),d=a.getHours(),a=a.getMinutes();1<b-d||1===b-d&&c>a?o($("#alarm .bar.bar3")[0].getContext("2d"),d/12,(b-d)/12,30,55,"#49a"):(1===b-d&&c<=a&&(c+=60),o($("#alarm .bar.bar3")[0].getContext("2d"),a/60,(c-a)/60,30,55,"#49a"))}else $("#alarm .bar.bar3").hide();setTimeout(function(){(l||f)&&p()},1E3)},v=function(){j=!0;if(f){var a=(new Date).getTime(),
b={d:864E5,h:36E5,m:6E4,s:1E3,ms:1},d="";n=Math.max(0,f.getTime()-a);if(0<=n){0===n&&($(document).unbind("keydown mousedown",s),$(document).bind("keydown mousedown",r),m(),c&&c(),j=!1);for(var e in b)a=Math.floor(n/b[e]),a=isNaN(a)?0:a,n-=a*b[e],n=Math.max(0,n),"ms"!=e?a=9<a?a:"0"+a:9>=a?a="00"+a:99>=a&&(a="0"+a),d+='<span class="number">'+a+"</span>",d+='<span class="label">'+e+"</span>";$("#alarm .details .countdown").html(d);j&&setTimeout(function(){v()},40)}else j=!1}else $("#alarm .details .countdown").html(""),
j=!1},w=function(a){j||v();$("#alarm .details .date").text(Language.date_to_str(a));$("#alarm .details .time .minutes").text(9<a.getMinutes()?a.getMinutes():"0"+a.getMinutes());$("#alarm .details .time .hours").text(12<a.getHours()?a.getHours()-12:0==a.getHours()?12:a.getHours());$("#alarm .details .time .ampm *").removeClass("active");12<=a.getHours()?$("#alarm .details .time .ampm .pm").addClass("active"):$("#alarm .details .time .ampm .am").addClass("active")},u=function(){p();f?($("#alarm .noset").hide(),
$("#alarm .details").show(),w(f)):($("#alarm .noset").show(),$("#alarm .details").hide());$("#alarm").slideDown(100,function(){$("#alarm .clock").animate({opacity:1,rotate:"+=180"},1E3+2E3*Math.random());$("#alarm .bar.bar1").animate({opacity:1,rotate:-360*(Math.floor(2*Math.random())+1)},1E3+2E3*Math.random());$("#alarm .bar.bar2").animate({opacity:1,rotate:360*(Math.floor(2*Math.random())+1)},1E3+2E3*Math.random());$("#alarm .bar.bar3").animate({opacity:1,rotate:-360*(Math.floor(2*Math.random())+
1)},1E3+2E3*Math.random())})},t=function(a,e,g,k){f&&console.log("Overwrote alarm for "+a.toString());k||(i=a);f=a;c=e;d=g;console.log("Set alarm for "+a.toString());u();b&&(a=new Date,a=Math.round((f.getTime()-a.getTime())/1E3),alert("setalarm,"+a));mpmetrics.track("Set an alarm.");return!0},q=function(){if(b){var a=new Date,a=Math.round((f.getTime()-a.getTime())/1E3);alert("cancelalarm,"+a)}f=null;u();mpmetrics.track("Stopped an alarm.")},s=function(){$(document).unbind("keydown mousedown",s);q();
d&&d.call(null,i);return!1},r=function(){$(document).unbind("keydown mousedown",r);h?(k++,$(document).bind("keydown mousedown",s),a.stop(),alarm_date=new Date,alarm_date.setTime(alarm_date.getTime()+e),t(alarm_date,c,d,!0)):(f=null,a.stop(),d&&d.call(null,i));return!1};return{unset:q,set:t,setSnooze:function(a){h=!0;e=a},mode:function(a){if(void 0==a)return l;a?(l=!0,mpmetrics.track("Opened clock."),Utilities.is_chrome&&$("#config").slideDown("fast"),$("#editbox").fadeIn("fast"),u()):(l=!1,$("#config").slideUp("fast"),
$("#editbox").fadeOut("fast"),f||$("#alarm").slideUp("fast"))},isset:function(){return!!f},clear_songs:function(){g=[]},add_song:function(a){g.push(a)},num_songs:function(){return g.length},volume:function(b){a.volume(b)}}},Application=function(){};Application.prototype.hear=!1;Application.prototype.receive=function(){};var Screen=function(a){Application.apply(this,arguments);this.screen=a};Screen.prototype=new Application;Screen.prototype.draw=function(){this.screen.show()};
Screen.prototype.quit=function(){var a=this.screen;a.animate({height:0,opacity:0},300,function(){a.hide().css("opacity",1)})};Screen.prototype.bind=function(){};Screen.prototype.unbind=function(){};
var AlarmApp=function(a,b,c){Screen.apply(this,arguments);this.ui=b;this.player=new Player($("#alarm_song"));this.alarm=new Alarm(this.player,c);this.clock=new Clock($("#clock"));this.wakeup_script=this.wakeup_reminder="";this.reminder_question=!1;var d=this,f=function(){mpmetrics.track("Alarm went off.")},e=function(){var a=new TodayApp($("#today_screen"),b,function(){var a=new WeatherApp($("#weather_screen"),b,function(){b.switch_app(d)});b.switch_app(a)});b.switch_app(a)},g=function(a){d.ui.nocallback();
clearTimeout(d.twitter_wait);var c="";36E5<(new Date).getTime()-a.getTime()&&(c="It's already "+Language.date_to_time(a)+".");d.wakeup_reminder?b.express(c+"Hey! Remember "+d.wakeup_reminder+".",e):c?b.express(c,e):e()};this.mappings=[{regex:/(stop|unset|don\'t|do not)\s+.*?(alarm|wake)/gi,action:function(){this.alarm.unset();this.ui.express("okay")}},{regex:/(rmb|remember|remind\s+(me)?).*/gi,action:function(a,b){var c=b[0].indexOf("rmb"),d=b[0].indexOf("remember");-1<b[0].indexOf("remind")?(c=b[0].indexOf("me"),
c=b[0].substr(c+2)):c=-1<c?b[0].substr(c+3):b[0].substr(d+8);d=c.indexOf("in");if(-1!=d){var e=c.substr(d+2);if(e=Language.str_to_seconds(e))alarm_date=new Date,alarm_date.setTime(alarm_date.getTime()+e),this.alarm.set(alarm_date,f,g)&&(this.set_reminder(c.substr(0,d)),this.ui.express("I can remind you "+c+"."));this.alarm.isset()||(this.set_reminder(c),this.ui.express("Okay, remind you "+c+"."),setTimeout(function(){if(""==$("#command").val())this.ui.express("When do you want me to remind you?"),
this.reminder_question=!0},5E3))}else(e=Language.str_to_date(c))?this.alarm.set(e,f,g)?(this.set_reminder(c),this.ui.express("I can remind you "+c+".")):this.ui.express("sorry"):(this.set_reminder(c),this.ui.express("Okay, remind you "+c+"."),this.alarm.isset()||setTimeout(function(){if(""==$("#command").val())this.ui.express("What time do you want me to remind you?"),this.reminder_question=!0},5E3))}},{regex:/(set|wake)\s+.*(in)\s+.*/gi,action:function(a,b){var c=b[0].indexOf("in"),c=b[0].substr(c+
2);(c=Language.str_to_seconds(c))?(alarm_date=new Date,alarm_date.setTime(alarm_date.getTime()+c),this.alarm.set(alarm_date,f,g)):this.ui.express("sorry")}},{regex:/(set|wake)\s+.*?(at|for).+/gi,action:function(a,b){b[0].indexOf("set");b[0].indexOf("wake");var c=b[0].substr(4);(c=Language.str_to_date(c))?this.alarm.set(c,f,g):this.ui.express("sorry")}},{regex:/(flexible|snooze)(\s+for (.+))?$/i,action:function(a,b){var c=Language.str_to_seconds(b[3]||"5 minutes");c&&this.alarm.setSnooze(c);this.ui.express("okay")}},
{regex:/(thank.*|thx|great|sweet|graci(as)?)/gi,action:function(){this.ui.express("welcome")}},{regex:/(don\'t|do not)/gi,action:function(){this.clear_reminder();this.ui.express("I won't.")}},{regex:/(hi|hello|what\'s up|hey|sup|wsup)(\s+|$)/gi,action:function(){this.ui.express("greeting")}},{regex:/(time|what time is it)/gi,action:function(){this.clear_reminder();var a=new Date,b=a.getMinutes(),c=a.getHours()%12;this.ui.express("It is "+(0==c?12:c)+(0==b?"":":"+b)+(12<=a.getHours()?" in the afternoon.":
" in the morning."))}},{regex:/(help|new|confused|wtf|aid)/gi,action:function(){$("#helpbox").slideDown("fast");this.ui.express("help")}},{regex:/^about$/gi,action:function(){this.ui.express("about")}}]};AlarmApp.prototype=new Screen;
AlarmApp.prototype.draw=function(){Utilities.query_string("reset")&&$.Storage.set("first_login","new");if("complete"!=$.Storage.get("first_login")){this.ui.express("Start typing in the textbox below!");if(Utilities.mp3able){var a=this;setTimeout(function(){a.ui.express("You can also drag some mp3 files onto this page and use it as your alarm!")},4E3)}$("#helpbox").slideDown("fast");$.Storage.set("first_login","complete")}this.screen.fadeIn(1E3);this.clock.fadeIn(1E3);this.alarm.mode(!1)};
AlarmApp.prototype.hear=function(a){mpmetrics.track("Entered command.",{command:a});for(var b=0;b<this.mappings.length;b++){var c;if(c=a.match(this.mappings[b].regex)){mpmetrics.track("Command matched.",{command:a});this.mappings[b].action.apply(this,[a,c]);this.ui.switch_app(this);return}}a.match(/(^\s*|\s+)(clock|alarm|back|stop|quit)[^a-zA-Z0-9]*/gi)&&this.ui.switch_app(this)};
AlarmApp.prototype.bind=function(){var a=this,b=this.alarm;this.clock.click(function(){b.mode(!b.mode())});$("#music .close").click(function(){b.clear_songs();$("#music .list .song.selected").each(function(){b.add_song($(this).data("url"))});$("#config .info .text").text("Selected "+b.num_songs()+" song"+(1==b.num_songs()?"":"s")+".");0==b.num_songs()&&$("#config").removeClass("active");$("#config .form").html($("#config .form").html());$("#music").fadeOut("fast")});$("#music .inv").click(function(){$("#music .list .song").each(function(){$(this).trigger("click")})});
$("#music .all").click(function(){$("#music .list .song").each(function(){$(this).hasClass("selected")||$(this).trigger("click")})});$("#config .selection").live("change",function(){$("#config .problem").text("");$("#config .info .text").text("Reading directory...");a.receive(this.files)});$("#command textarea").focus()};
AlarmApp.prototype.unbind=function(){this.clock.unbind("click");$("#config .selection").die("change");$("#music .close").unbind("click");$("#music .inv").unbind("click");$("#music .all").unbind("click");$("#music .selection").unbind("change")};AlarmApp.prototype.clear_reminder=function(){this.wakeup_reminder=""};AlarmApp.prototype.set_reminder=function(a){if(""!=a&&!this.reminder_question)this.wakeup_reminder=a};
AlarmApp.prototype.populate_list=function(a){if(0!=a.length){var b=a.shift(),c=this;c.player.load_tags(b,function(d){this.sem--;var f=guessSong(b.webkitRelativePath||b.mozFullPath||b.fileName),e=$("<tr></tr>").addClass("song"),g=c.player.file_url(b);e.data("url",g);e.click(function(){$(this).toggleClass("selected")});var g=$("<td></td>").text(d.Title||f.Title),h=$("<td></td>").text(d.Artist||f.Artist),d=$("<td></td>").text(d.Album||f.Album);g.appendTo(e);h.appendTo(e);d.appendTo(e);e.appendTo(c.table);
c.populate_list(a)});setTimeout(function(){c.populate_list(a)},100)}};AlarmApp.prototype.receive=function(a){$("#config").addClass("active");mpmetrics.track("Attempted to change music.");var b=this;setTimeout(function(){b.player.playlist(a,function(a){$("#config .info .text").text("Found "+a.length+" song"+(1==a.length?"":"s")+".");$("#music").fadeIn("fast");b.table=$("#music .list").html("");b.populate_list.call(b,a)})},10)};
var LoginApp=function(a,b,c,d,f,e){this.screen=a;this.ui=b;this.ai=c;this.on_auth=d;this.on_guest=f;this.started_typing=!1;Screen.apply(this,arguments)};LoginApp.prototype=new Screen;
LoginApp.prototype.draw=function(){this.screen.show();var a=this.screen.find(".guest");a.show().css("opacity",0);setTimeout(function(){a.animate({opacity:1,"margin-left":"+=30"},800)},1500);this.screen.find(".frame").css("opacity",0).scale(0.5).animate({opacity:1,scale:"1"},300);var b=this.screen.find(".form");b.css("opacity",0).scale(0.2).animate({opacity:1,scale:"1"},200,function(){var a=b.find(".email .input");""===a.val()?a.focus():b.find(".password .input").focus()});this.screen.find(".form .logo").css("opacity",
0.8).rotate(0).animate({opacity:1,rotate:"+=90"},700);this.screen.find(".form .textbox").css("opacity",1).css("right","75px");this.screen.find(".form .signup").css("opacity",0).css("right","75px");b.find(".password .input").val("");var c=this;this.help_timer=setTimeout(function(){c.started_typing||c.ui.express("Just fill in your email and password to sign up!")},4E3)};
LoginApp.prototype.set_info=function(a){var b=this.screen.find(".info"),c=this;c.info_string=a;b.css("opacity",0.3).text("").animate({opacity:1},1200);var d=function(){b.text(b.text()+c.info_string.substr(0,1));c.info_string=c.info_string.substr(1);0<c.info_string.length&&setTimeout(d,35)};d()};LoginApp.prototype.login=function(){this.ai.logout();this.ui.mute();this.ui.switch_app(this)};LoginApp.prototype.hear=function(a){"logout"===a&&this.login()};
LoginApp.prototype.bind=function(){var a=this.screen,b=this;a.find(".email .input").change(function(){""!==$(this).val()&&($(this).parents(".form"),User.check($(this).val(),function(a){a?b.set_info("User match found"):b.set_info("New user profile")}))});a.find(".email .input").blur(function(){$(this).trigger("change")});a.find(".textbox .input").keydown(function(a){b.screen.find(".form");13===a.keyCode&&User.check(b.screen.find(".form .email .input").val(),function(a){if(a)e=b.screen.find(".form"),
g=e.find(".email"),h=e.find(".password"),""===g.find(".input").val()?b.set_info("Email required"):""===h.find(".input").val()?b.set_info("Password required"):User.login(g.find(".input").val(),h.find(".input").val(),function(a){b.on_auth.call(b,a)},function(a){"your password is invalid"===a?(b.set_info("Wrong password!"),e.data("shaking")||(e.data("shaking",!0),e.animate({"margin-left":"+=10"},100,function(){e.animate({"margin-left":"-=20"},100,function(){e.animate({"margin-left":"+=7"},100,function(){h.find(".input").select().focus();
e.data("shaking",!1)})})}))):(b.set_info("Error! :("),b.ui.express("Login failed because "+a.toLowerCase()+"."))});else{var c=b.screen.find(".frame");c.animate({scale:0.96},100,function(){c.animate({scale:1},100)});b.screen.find(".form .logo").css("opacity",0.8).rotate(0).animate({opacity:1,rotate:"-=90"},700);var e=b.screen.find(".form"),g=e.find(".email"),h=e.find(".password");""===g.find(".input").val()?b.set_info("Email required"):""===h.find(".input").val()?b.set_info("Password required"):(g.animate({right:"+=50",
opacity:0},200),h.animate({right:"-=50",opacity:0},250,function(){var a=b.screen.find(".signup"),d=a.find(".continue");d.click(function(){User.register(g.find(".input").val(),h.find(".input").val(),function(a){b.on_auth.call(b,a)},function(a){b.set_info("Error! :(");b.ui.express("Registration failed because "+a.toLowerCase()+".")})});var e=a.find(".no");e.click(function(){a.animate({opacity:0},300,function(){e.unbind("click");d.unbind("click");a.hide();g.animate({right:"75px",opacity:1},200,function(){g.find(".input").select().focus()});
h.animate({right:"75px",opacity:1},250);c.animate({scale:1.04},100,function(){c.animate({scale:1},100)})})});a.show().css("opacity",0).animate({right:"+=75",opacity:1},300,function(){d.focus()})}))}})});a.find(".textbox .input").keyup(function(){b.started_typing=!0;0<$(this).val().length?$(this).parent().find(".underlay").addClass("active"):$(this).parent().find(".underlay").removeClass("active")});a.find(".guest").click(function(){b.started_typing=!0;b.on_guest.call(b)});a.find(".textbox .input").each(function(){$(this).trigger("keyup")})};
LoginApp.prototype.unbind=function(){var a=this.screen;a.find(".email .input").unbind("change");a.find(".email .input").unbind("blur");a.find(".textbox .input").unbind("keydown");a.find(".textbox .input").unbind("keyup");a.find(".guest").unbind("click")};
LoginApp.prototype.quit=function(){this.screen.find(".frame").animate({opacity:0,scale:0.5},300);this.screen.find(".form").animate({opacity:0,scale:0.2},200);var a=this.screen.find(".guest");a.animate({opacity:0,"margin-left":"+=30"},300,function(){var b=a.css("margin-left"),b=parseInt(b.substr(0,b.length-2))-60+"px";a.hide().css("margin-left",b)})};var WeatherApp=function(a,b,c){this.screen=a;this.ui=b;this.callback=c;Screen.apply(this,arguments)};WeatherApp.prototype=new Screen;
WeatherApp.prototype.draw=function(){this.screen.show();var a=this.screen.find(".weather").hide(),b=this.screen.find(".location").hide(),c=this.ui,d=this.callback||function(){};$.ajax({url:"/json/get-weather",data:{},dataType:"json",success:function(f){var e=f.city.split(",");a.find(".temperature .number").text(f.temp);a.find(".condition").text(f.condition);b.find(".primary").text(e[0]);1<e.length&&b.find(".secondary").text(", "+e[1]);a.slideDown(200);setTimeout(function(){b.slideDown(200)},300);
f="The weather is "+f.temp+" degrees celcius in "+e[0]+". Conditions are "+f.condition.toLowerCase()+".";c.express(f,d)},error:function(){d.call(this)}})};WeatherApp.prototype.hear=function(a){a.match(/weather/gi)&&this.ui.switch_app(this)};var TodayApp=function(a,b,c){this.screen=a;this.ui=b;this.callback=c;Screen.apply(this,arguments)};TodayApp.prototype=new Screen;
TodayApp.prototype.draw=function(){this.screen.show();var a=new Date,b=this.screen.find(".date"),c=this.callback||function(){},d=Language.date_to_str(a)+", "+a.getFullYear();b.hide().slideDown(200);b.find(".month").text(Language.mon_map[a.getMonth()]);b.find(".day").text(a.getDate());b.find(".year").text(a.getFullYear());this.ui.express("Today is "+d+".",c)};TodayApp.prototype.hear=function(a){a.match(/today\??$/gi)&&this.ui.switch_app(this)};
var ScheduleApp=function(a,b,c){this.screen=a;this.ui=b;Screen.apply(this,arguments)};ScheduleApp.prototype=new Screen;
ScheduleApp.prototype.draw=function(){this.screen.show();var a=this.screen.find(".day");a.css("margin-left","188px").css("opacity",0).animate({opacity:1,marginLeft:"-=20"},600);var b=this.screen.find(".calendar"),c=b.find(".body"),d=b.find(".date");c.height(c.height()-20);b.css("margin-top",c.height()-370+"px").css("margin-left","-520px").css("opacity",0).animate({opacity:1,marginLeft:"-=70"},200);d.css("left","100px").css("opacity",0).animate({opacity:0.7,left:"30px"},400);var f=new Date,c=b.find(".boxes").html(""),
e,d=f.getMonth(),g=new Date;g.setMonth(d);g.setDate(1);e=g.getDay();var h=-1*e,g=(d+13)%12,k=e?Language.max_day_map[g]+h:1;for(e=0;28>e;e++){k>=Language.max_day_map[g]?(g=(d+12)%12,k=1):k++;var i=$('<div class="box"></div>').text(k);d==g&&i.addClass("cur_month");i.appendTo(c).css("opacity",0).css("top",Math.floor(100*Math.random())+"px").animate({opacity:1,top:0},600)}a.find(".dayweek").text(Language.day_map[f.getDay()]);a.find(".number").text(f.getDate());b.find(".events").html("");var j=function(c,
d,e,g){var i=b.find(".events"),k=717/7,u=Math.floor((d-h)/7.01)+Math.floor((c-h)/7.01),t,q,s;q=d-h+c-1;7>=q?(s=0,t=q+h,q=-h):(t=q%7,s=q-t+h,q=0);var r=$('<div class="bar"></div>').addClass(e);r.css("top",50*u+14).css("left","717px").css("width",0).animate({width:t*k+"px",left:q*k},350,function(){0!=d&&j(c,s,e,g)});r.data("title",g.title);r.data("details",g.details);r.appendTo(i);r.hover(function(){a.find(".dayweek").text("");a.find(".number").text("");a.find(".title").text($(this).data("title"));
a.find(".details").text($(this).data("details"))},function(){a.find(".dayweek").text(Language.day_map[f.getDay()]);a.find(".number").text(f.getDate());a.find(".title").text("");a.find(".details").text("")})};setTimeout(function(){j(1,3,"blue",{title:"June 1-3",details:"Get ready for the concert on saturday."})},200);j(1,7,"red",{title:"June 1-7",details:"Driving to disneyland!"})};
ScheduleApp.prototype.quit=function(){var a=this.screen;a.find(".day").animate({opacity:0,marginLeft:"+=20"},100);var b=a.find(".calendar"),c=b.find(".body"),d=b.find(".date");c.height(c.height()+20);b.animate({opacity:0,marginLeft:"+=70"},200);d.animate({opacity:0,left:"-70px"},400,function(){a.hide()});b.find(".boxes .box").each(function(){$(this).animate({opacity:0,top:Math.floor(300*Math.random())},150)})};
ScheduleApp.prototype.hear=function(a){a.match(/(^\s*|\s+)(scheduler?|calend(e|a)r)(\s*$|\s+)/gi)&&this.ui.switch_app(this)};var UnicornsApp=function(a,b){this.screen=a;this.ui=b;Screen.apply(this,arguments)};UnicornsApp.prototype=new Screen;
UnicornsApp.prototype.draw=function(){this.screen.show();this.screen.html('<div class="video"><embed src="http://www.youtube.com/v/RW6Lp3Y3Vxs&autoplay=1&showinfo=0&showsearch=0&rel=0&fs=1&loop=1&controls=0&autohide=1&start=17&iv_load_policy=3" type="application/x-shockwave-flash" allowfullscreen="true" wmode="transparent" width="640" height="480"></embed></div>').find(".video").scale(0.4).animate({scale:1},400)};
UnicornsApp.prototype.quit=function(){var a=this.screen;a.find(".video").animate({scale:0},400,function(){a.hide()})};UnicornsApp.prototype.hear=function(a){a.match(/(^\s*|\s+)(unicorns?!?|productiv)/gi)&&this.ui.switch_app(this)};var IronManApp=function(a,b){this.screen=a;this.ui=b;Screen.apply(this,arguments)};IronManApp.prototype=new Screen;
IronManApp.prototype.draw=function(){this.screen.show();this.screen.html('<div class="video"><embed src="http://www.youtube.com/v/-u8F7Y6p2A0&autoplay=1&showinfo=0&showsearch=0&rel=0&fs=1&loop=0&controls=0&autohide=1&start=4&iv_load_policy=3" type="application/x-shockwave-flash" allowfullscreen="true" wmode="transparent" width="640" height="480"></embed></div>').find(".video").scale(0.4).animate({scale:1},400)};
IronManApp.prototype.quit=function(){var a=this.screen;a.find(".video").animate({scale:0},400,function(){a.hide()})};IronManApp.prototype.hear=function(a){a.match(/(^\s*|\s+)(iron|demo)/gi)&&this.ui.switch_app(this)};var DougieApp=function(a,b){this.screen=a;this.ui=b;Screen.apply(this,arguments)};DougieApp.prototype=new Screen;
DougieApp.prototype.draw=function(){this.screen.show();this.screen.html('<div class="video"><embed src="http://www.youtube.com/v/3uYi729Rf0U&autoplay=1&showinfo=0&showsearch=0&rel=0&fs=1&loop=0&controls=0&autohide=1&start=27&iv_load_policy=3" type="application/x-shockwave-flash" allowfullscreen="true" wmode="transparent" width="640" height="480"></embed></div>').find(".video").scale(0.4).animate({scale:1},400)};
DougieApp.prototype.quit=function(){var a=this.screen;a.find(".video").animate({scale:0},400,function(){a.hide()})};DougieApp.prototype.hear=function(a){a.match(/(^\s*|\s+)dougie/gi)&&this.ui.switch_app(this)};
var HelloAlarm=function(){mpmetrics.track("I'm Alive.",{"user-agent":navigator.userAgent});var a=!1;"mac1"==Utilities.query_string("v")&&(a=!0);$(window).resize(function(){var a=Math.round(window.innerHeight/10);document.body.style.zoom=a+"%";$("body").css("-moz-transform","scale("+a/100+")")});$(window).trigger("resize");var b=new Artist($("#speech")),c=new Mediator,d=new AlarmApp($("#alarm_screen"),b,a),f=new TodayApp($("#today_screen"),b,function(){setTimeout(function(){b.switch_app(d)},1E3)}),
e=new DougieApp($("#dougie_screen"),b),g=new IronManApp($("#ironman_screen"),b),h=new UnicornsApp($("#unicorns_screen"),b),k=new ScheduleApp($("#schedule_screen"),b),i=new WeatherApp($("#weather_screen"),b,function(){setTimeout(function(){b.switch_app(d)},1E3)}),j=new LoginApp($("#login_screen"),b,c,function(a){c.login(a);mpmetrics.track("Logged In.",{email:a});b.unmute();$("#command .account").html("Logout");b.switch_app(d)},function(){mpmetrics.track("New guest");b.unmute();$("#command .account").html("Login");
b.switch_app(d)},a);b.register(j);b.register(d);b.register(f);b.register(i);b.register(k);b.register(h);b.register(g);b.register(e);$("body").bind("dragenter",function(){$("#filedrop").fadeIn("fast")});$("#filedrop").bind("dragover",function(a){a.stopPropagation();a.preventDefault()});$("#filedrop").bind("dragleave",function(){$("#filedrop").fadeOut("fast")});$("#filedrop")[0].addEventListener("drop",function(a){a.stopPropagation();a.preventDefault();$(this).fadeOut("fast");b.receive(a.dataTransfer&&
a.dataTransfer.files)},!1);$("#command .input").focus(function(){$("#command").addClass("active")});$("#command .input").blur(function(){$("#command").removeClass("active")});$("#command .input").keypress(function(a){if(13==a.keyCode)return $("#helpbox").slideUp("fast"),""!=$(this).val()&&b.hear($(this).val()),$(this).val(""),!1});$("#command .account").click(function(){j.login()});Utilities.query_string("reset")&&$.Storage.set("first_run","new");"complete"!=$.Storage.get("first_run")&&!c.is_logged_in()?
(b.express("Hello there! Welcome to HelloAlarm!"),$.Storage.set("first_run","complete"),j.login()):c.is_logged_in()?($("#command .account").html("Logout"),b.switch_app(d)):j.login();return{}};$(HelloAlarm);